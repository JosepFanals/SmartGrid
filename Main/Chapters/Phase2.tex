This chapter considers upgrading the system by means of installing additional lines. In the previous analysis, it was visible that the disconnection of specific lines resulted in an unsolvable problem. Often, no solution was obtained as a result of an exceedingly high demand compared to the available generation. The criteria $N-1$ was therefore not met, yet it is usually treated as a requirement by control center operators \cite{wang2013risk, gourtani2016robust}. 

The central aim of this chapter is reaching a robust grid, where a single failure does not compromise the full system. Several solutions were proposed, such as meshing the network, rising the voltage level, etc. This chapter is devoted to exploring the implications of such proposals. First, a more theoretical explanation describing the formulation is presented, and then, the analysis of results takes place. These results include electrical magnitudes as well as economic data. An optimal configuration is finally provided.

\section{Addition of lines}
Recall that the original system depicted in Figure \ref{fig:net1} was for the most part a radial system, in the sense that there was no redundancy in the connection of lines. The operating costs are non-negligible since a significant amount of energy cannot be delivered during faults. To combat this issue, the installation of various new lines (in red) is contemplated, as shown in Figure \ref{fig:net2}.


\begin{figure}[!htb]\centering

  \begin{circuitikz}[/tikz/circuitikz/bipoles/length=1cm, line width=0.8pt]

    % grid
    \draw[gray!50!white, line width=0.5pt] (0.0,0.0) to [short] (8.0,0.0);
    \draw[gray!50!white, line width=0.5pt] (0.0,1.6) to [short] (8.0,1.6);
    \draw[gray!50!white, line width=0.5pt] (0.0,3.2) to [short] (8.0,3.2);
    \draw[gray!50!white, line width=0.5pt] (0.0,4.8) to [short] (8.0,4.8);
    \draw[gray!50!white, line width=0.5pt] (0.0,6.4) to [short] (8.0,6.4);
    \draw[gray!50!white, line width=0.5pt] (0.0,8.0) to [short] (8.0,8.0);

    \draw[gray!50!white, line width=0.5pt] (0.0,0.0) to [short] (0.0,8.0);
    \draw[gray!50!white, line width=0.5pt] (1.6,0.0) to [short] (1.6,8.0);
    \draw[gray!50!white, line width=0.5pt] (3.2,0.0) to [short] (3.2,8.0);
    \draw[gray!50!white, line width=0.5pt] (4.8,0.0) to [short] (4.8,8.0);
    \draw[gray!50!white, line width=0.5pt] (6.4,0.0) to [short] (6.4,8.0);
    \draw[gray!50!white, line width=0.5pt] (8.0,0.0) to [short] (8.0,8.0);


    % generators
    \draw (3.2,-1.8) to [sV, fill=magenta!70!cyan] (3.2,-1.2);
    \draw [short] (3.2,-1.2) to [short] (3.2,-1.0);
    \draw (-1.8,1.6) to [sV, fill=green!50!white] (-1.2,1.6);
    \draw [short] (-1.2,1.6) to [short] (-1.0,1.6);
    \draw (9.2,1.6) to [sV, fill=cyan!50!white] (9.8,1.6);
    \draw [short] (9.2,1.6) to [short] (9.0,1.6);
    \draw (4.8,3.6) to [sV, fill=black!60!white] (4.8,3.0);
    \draw [short] (4.8,3.6) to [short] (4.8,3.8);
    \draw (8.4,4.8) to [sV, fill=yellow!60!white] (9.0,4.8);
    \draw [short] (8.0,4.8) to [short] (8.4,4.8);
    \draw (1.6,9.2) to [sV, fill=orange!60!white] (1.6,9.8);
    \draw [short] (1.6,9.0) to [short] (1.6,9.2);


    % large buses
    \draw[line width=2.5pt] (2.7,0) to [short] (3.7,0);
    \draw[line width=2.5pt] (0.0,1.1) to [short] (0,2.1);
    \draw[line width=2.5pt] (8.0,1.1) to [short] (8,2.1);
    \draw[line width=2.5pt] (1.1,8) to [short] (2.1,8);
    \draw[line width=2.5pt] (2.7,3.2) to [short] (3.7,3.2);
    \draw[line width=2.5pt] (2.7,4.8) to [short] (3.7,4.8);
    \draw[line width=2.5pt] (4.3,6.4) to [short] (5.3,6.4);
    \draw[line width=2.5pt] (0.0,5.9) to [short] (-0.0,6.9);
    \draw[line width=2.5pt] (8,4.3) to [short] (8,5.3);
    \draw[line width=2.5pt] (4.3,4.8) to [short] (5.3,4.8);

    % small buses
    \draw[line width=2.5pt] (2.9,-1) to [short] (3.5,-1);
    \draw[line width=2.5pt] (-1.0,1.3) to [short] (-1,1.9);
    \draw[line width=2.5pt] (9,1.3) to [short] (9,1.9);
    \draw[line width=2.5pt] (4.5,3.8) to [short] (5.1,3.8);
    \draw[line width=2.5pt] (1.3,9.0) to [short] (1.9,9.0);

    \draw[line width=2.5pt] (1.75,3.2) to [short] (1.75,2.6);
    \draw[line width=2.5pt] (1.75,4.8) to [short] (1.75,4.2);
    \draw[line width=2.5pt] (-0.95,6.7) to [short] (-0.95,6.1);
    \draw[line width=2.5pt] (4.5,7.35) to [short] (5.1,7.35);

    % trafos
    \draw (3.2,-1.0) to [voosource] (3.2,0.0);
    \draw (-1,1.6) to [voosource] (0,1.6);
    \draw (8,1.6) to [voosource] (9,1.6);
    \draw (1.6,8) to [voosource] (1.6,9);
    \draw (4.8,4.8) to [voosource] (4.8,3.8);

    \draw (-1,6.4) to [voosource] (0,6.4);
    \draw (4.8,6.4) to [voosource] (4.8,7.4);
    \draw (2.7,4.5) to [voosource] (1.7,4.5);
    \draw (2.7,2.9) to [voosource] (1.7,2.9);

    % loads
    \draw[-{Triangle[length=5mm, width=2mm]}, draw=blue!60!white, fill=blue!60!white] (-1,6.4) -- (-1.6,6.4);
    \draw[-{Triangle[length=5mm, width=2mm]}, draw=blue!60!white, fill=blue!60!white] (4.8,7.4) -- (4.8,8.0);
    \draw[-{Triangle[length=5mm, width=2mm]}, draw=red!60!white, fill=red!60!white] (1.7,4.5) -- (1.1,4.5);
    \draw[-{Triangle[length=5mm, width=2mm]}, draw=blue!60!white, fill=blue!60!white] (1.7,2.9) -- (1.1,2.9);

    \draw (3.0,4.8) to [short] (3.0,4.5);
    \draw (3.0,4.5) to [short] (2.7,4.5);

    \draw (3.0,3.2) to [short] (3.0,2.9);
    \draw (3.0,2.9) to [short] (2.7,2.9);

    % lines
    \draw (3.15,0) to [short] (3.15,3.2);
    \draw (3.25,0) to [short] (3.25,3.2);
    \draw (3.15,3.2) to [short] (3.15,4.8);
    \draw (3.25,3.2) to [short] (3.25,4.8);
    \draw (4.6,4.8) to [short] (4.6,5.1);
    \draw (4.6,5.1) to [short] (3.4,5.1);
    \draw (3.4,5.1) to [short] (3.4,4.8);
    \draw (3.15,4.8) to [short] (3.15,5.1);
    \draw (3.25,4.8) to [short] (3.25,5.1);
    \draw (3.15,5.1) to [short] (4.55,6.1);
    \draw (3.25,5.1) to [short] (4.65,6.1);
    \draw (4.55,6.1) to [short] (4.55,6.4);
    \draw (4.65,6.1) to [short] (4.65,6.4);
    \draw (5.0,6.4) to [short] (5.0,6.1);
    \draw (5.0,6.1) to [short] (7.7,5.1);
    \draw (7.7,5.1) to [short] (8.0,5.1);
    \draw (0,6.4) to [short] (0.3,6.4);
    \draw (0.3,6.4) to [short] (3.0,5.1);
    \draw (3.0,5.1) to [short] (3.0,4.8);

    % proposed new lines
    \draw[dashed, draw=red] (8, 4.4) to [short] (3.5,4.4);
    \draw[dashed, draw=red] (3.5,4.4) to [short] (3.5,4.8);
    \draw[dashed, draw=red] (8,4.4) to [short] (3.5,3.2);
    \draw[dashed, draw=red] (4.5,6.4) to [short] (0,6.4);
    \draw[dashed, draw=red] (3,0) to [short] (3,4.8);
    \draw[dashed, draw=red] (3,3.2) to [short] (0,6.2);
    \draw[dashed, draw=red] (3,0) to [short] (0,6.2);

    \draw[dashed, draw=red] (8,5.0) to [short] (4.8,5.0);
    \draw[dashed, draw=red] (4.8,5.0) to [short] (4.8,4.8);
    \draw[dashed, draw=red] (8,4.4) to [short] (3.3,0);

    \draw[draw=red] (6,4.85) to [short] (6.3,5.15);
    \draw[draw=red] (6.2,4.85) to [short] (6.5,5.15);

    \draw[draw=red] (6,4.25) to [short] (6.3,4.55);
    \draw[draw=red] (6.2,4.25) to [short] (6.5,4.55);

    \draw[draw=red] (2,6.25) to [short] (2.3,6.55);
    \draw[draw=red] (2.2,6.25) to [short] (2.5,6.55);

    \draw[draw=red] (2.85,1.5) to [short] (3.15,1.8);
    \draw[draw=red] (2.85,1.7) to [short] (3.15,2.0);

    \draw[draw=red] (2.3,3.6) to [short] (2.6,3.9);
    \draw[draw=red] (2.2,3.7) to [short] (2.5,4.0);

    \draw[draw=red] (5.3,1.6) to [short] (5.0,1.9);
    \draw[draw=red] (5.4,1.7) to [short] (5.1,2.0);

    % legend
    \draw[-{Triangle[length=5mm, width=2mm]}, draw=blue!60!white, fill=blue!60!white] (3.0,8.4) -- (4.0,8.4);
    \draw[-{Triangle[length=5mm, width=2mm]}, draw=red!60!white, fill=red!60!white] (3.0,9.1) -- (4.0,9.1);
    \draw (3.2,9.8) to [sV, fill=magenta!70!cyan] (3.8,9.8);

    \draw (6.0,9.8) to [sV, fill=black!60!white] (6.6,9.8);
    \draw (6.0,9.1) to [sV, fill=yellow!60!white] (6.6,9.1);
    \draw (6.0,8.4) to [sV, fill=green!50!white] (6.6,8.4);

    \draw (9.0,9.8) to [sV, fill=orange!60!white] (9.6,9.8);
    \draw (9.0,9.1) to [sV, fill=cyan!50!white] (9.6,9.1);
    \draw[dashed, draw=red] (9.0,8.4) to [short] (9.5,8.4);

    \node at (4.73, 9.8) {\footnotesize Nuclear};
    \node at (4.66, 9.1) {\footnotesize Load I};
    \node at (4.72, 8.4) {\footnotesize Load II};

    \node at (7.64, 9.8) {\footnotesize Dismantled};
    \node at (7.49, 9.1) {\footnotesize Intercon.};
    \node at (7.28, 8.4) {\footnotesize Wind};

    \node at (10.25, 9.8) {\footnotesize Solar};
    \node at (10.40, 9.1) {\footnotesize Storage};
    \node at (10.45, 8.4) {\footnotesize New line};

    \draw[gray!50!white, line width=0.5pt] (8.5,8.0) to [short] (10.1,8.0);
    \draw[gray!50!white, line width=0.5pt] (8.5,6.4) to [short] (10.1,6.4);
    \draw[gray!50!white, line width=0.5pt] (8.5,6.4) to [short] (8.5,8.0);
    \draw[gray!50!white, line width=0.5pt] (10.1,6.4) to [short] (10.1,8.0);

    \node at (9.30, 6.2) {\footnotesize 50 km};
    \node[rotate=90] at (10.3, 7.2) {\footnotesize 50 km};

    \draw [fill=gray, opacity=0.2, line width=0.01pt] (2.95,10.15) rectangle (11.5,8.05);
    \draw [fill=gray, opacity=0.2, line width=0.01pt] (11.5,8.05) rectangle (8.05,6.05);

    % buses nodes and labels
    \node at (3.6, 0.2) {8};
    \node at (3.6, -1.0) {1};
    \node at (3.6, 4.6) {9};
    \node at (1.75, 5.0) {2};
    \node at (3.6, 3.0) {10};
    \node at (1.75, 3.45) {3};
    \node at (4.4, 6.6) {11};
    \node at (4.4, 7.6) {4};
    \node at (0.2, 6.7) {12};
    \node at (-1.2, 6.7) {5};
    \node at (5.2, 4.6) {13};
    \node at (5.3, 3.8) {7};
    \node at (7.8, 4.6) {6}; 

  \end{circuitikz}

  \caption{Overview of the network with the addition of lines. Double line if double circuit.}
  \label{fig:net2}
\end{figure}


By installing new lines, an additional installation cost has to be considered, but a reduction on the operating costs is expected. It is worth worth mentioning that not all contemplated new lines ought to be installed. Rather, by adding one or two of them, the system could already be operating under the desired conditions. There is a cost-benefit tradeoff, so only a few specific new lines will be selected. 

\subsection{Formulation}
The formulation of the topology deserves special attention. Mathematically, it is defined as:
\begin{equation}
  \{\mathcal{N} \in \mathcal{P}([n]) \left. \right\vert |\mathcal{N}|=k \},
\end{equation}
where $\mathcal{N}$ denotes a subset, that is, possible topology out of the full set of configurations $\mathcal{P}([n])$, $[n] = \{\mathbf{1}_{\sigma_1},\mathbf{1}_{\sigma_2},...,\mathbf{1}_{\sigma_n}\}$ represents the set of elements that cause variations on the topology, and $k$ symbolizes the total amount of possibilities. In the contingency analysis, the set $[n]$ is a function of the state of the elements (mainly, lines). These can be in service or out of service, so can be regarded as boolean variables. The employed notation, of the form $\mathbf{1}_{\sigma_i}$, is 1 if the indicator variable $\sigma_i$ holds true; otherwise, it is 0. The indicator variable, in the case under study, is simply the state of each particular line.

Note that the whole set $\mathcal{P}$ can be further divided into the set composed of the original lines $\mathcal{A}$, and the set of new lines $\mathcal{B}$. Let $j$ indicate the number of lines in the original set $\mathcal{A}$, and $n-j$ the amount of lines in the new set $\mathcal{B}$. In the particularized case shown in Figure \ref{fig:net2}, $j=6$ and $n-j=8$. Thus, these subsets are expanded and explicitly become:
\begin{equation}
  \begin{cases}
  \mathcal{A} = \{\mathbf{1}_{\sigma_{1}}, \mathbf{1}_{\sigma_{2}},..., \mathbf{1}_{\sigma_{j}}\}, \\
  \mathcal{B} = \{\mathbf{1}_{\sigma_{j+1}}, \mathbf{1}_{\sigma_{j+2}},..., \mathbf{1}_{\sigma_{n}}\}. \\
\end{cases}
\end{equation}
To perform the contingency analysis, we consider that one of the original lines if faulted. For instance, if line $i$ ends up disconnected, $\sigma_i\gets$ \texttt{false} while the rest of original lines $\sigma_r\gets$ \texttt{true} for $r=\{1,2,...,i-1,i+1,...,j\}$.

On the other hand, in the subset $\mathcal{B}$ it is not straightforward to estimate which lines should be connected or disconnected. Perhaps installing a single additional line is enough to meet the $N-1$ criteria, or maybe more lines are required. Hence, it has been decided that all permutations have to be analyzed. Since $\sigma$ are boolean variables, the total number $k$ of contingencies to simulate are:
\begin{equation}
  k = j 2^{(n-j)},
\end{equation}
so if $j=6$ and $n-j=8$, this results in $k=1536$ different topologies. Thus, a total of $1536$ timeseries power flows are computed. 

Security analysis in power systems has been traditionaly based on the usage of the DC power flow \cite{stott2009dc, capitanescu2011state}. It offers the advantage of being non-iterative (and consequently, fast), and allows to determine the influence of faults with the usage of transmission factors. However, its solution is just an approximation. Since the amount of situations remains reasonable, it has been decided to solve them with the typical Newton-Raphson up to the default precision of $1\cdot 10^{-8}$~MVA \cite{pandapower2018}. 

The general procedure to perform the contingency analysis is shown in Algorithm \ref{alg:1}.

\begin{algorithm}[!htb]
\DontPrintSemicolon
  
\KwInput{\texttt{net} initialized class, $j$, $n$}
  \KwOutput{stored results}
  Generate permutations $\forall \bm{\sigma}_{g}$ where $g=[1,2,...,2^{(n-j)}]$

  \For{$i=[1,2,...,j]$}
  {
    $\sigma_i\gets$\texttt{false}

    $\sigma_r\gets$\texttt{true}, where $r\neq i$ and $r\leq j$

    $\mathcal{A}\gets \{\mathbf{1}_{\sigma_{1}}, \mathbf{1}_{\sigma_{2}},..., \mathbf{1}_{\sigma_{j}}\}$\\

    \For{$g=[1,2,...,2^{(n-j)}]$}
    {
      $[\sigma_{j+1}, \sigma_{j+2},..., \sigma_n] \gets \bm{\sigma}_g$

    $\mathcal{B} \gets \{\mathbf{1}_{\sigma_{j+1}}, \mathbf{1}_{\sigma_{j+2}},..., \mathbf{1}_{\sigma_{n}}\}$\\

    $\mathcal{N} \gets \mathcal{A} \cup \mathcal{B}$

    \texttt{pandapower.timeseries.run\_timeseries(}$\mathcal{N}$,\texttt{net)}

    Store results
    }
  }
\caption{Pseudocode to solve the contingencies}
\label{alg:1}
\end{algorithm}
Out of all results extracted, an analysis procedure is required in order to determine which configuration meets the $N-1$ criteria. The requirements are listed below:
\begin{itemize}
  \item The losses in the lines have to stay below 2\%.
    \vspace{-0.5cm}
    \item The voltages have to be between a range of $\pm$10\%.
      \vspace{-0.5cm}
    \item All lines have to remain below 80\% its maximum capacity.
\end{itemize}
Apart from these requirements, an additional criteria has to do with the costs. These will be critical when choosing the best configuration out of all possible ones. Table \ref{tab:net_cost} displays the costs for the lines, depending on their representative voltage level and the number of circuits.

\begin{table}[!htb]\centering
  \begin{tabular}{cccc}
    \hline
    \textbf{Type} & \textbf{Mean (\texteuro)} & \textbf{Min-max range (\texteuro)} & \textbf{Median (\texteuro)} \\
    \hline
    380-400~kV, 2 circuits & 1060919 & 579771 - 1401585 & 1023703 \\
    380-400~kV, 1 circuits & 598231 & 302664 - 766802 & 597841 \\
    220-225~kV, 2 circuits & 407521 & 354696 - 461664 & 437263 \\
    220-225~kV, 1 circuits & 288289 & 157926 - 298247 & 218738 \\
    \hline
  \end{tabular}
  \caption{Network infraestructure costs for the lines. Data from \cite{acer}.}
  \label{tab:net_cost}
\end{table}

It has been decided to calculate the costs with mean value.


\subsection{Results}
Out of all results extracted, an analysis procedure is required in order to determine which configuration meets the $N-1$ criteria. The prechosen configurations are the ones that ensure that in spite of the disconnection of a given element, the power flow remains feasible and the design criterias are met. A total of 39 have satisfied all requirements. Table \ref{tab:top10_1} shows the top 10 cheapest topologies, according to the costs in Table \ref{tab:net_cost}. 

\begin{table}[!htb]\centering
  \begin{tabular}{ccc}
    \hline
    \textbf{Identifier} & \textbf{Additional lines} & \textbf{Infraestructure cost (M\texteuro)}\\
    \hline
    19 & [6-13, 6-10, 8-9, 10-12] &  359.50 \\
    214 & [6-13, 6-10, 11-12, 8-9] & 362.99 \\
    77 & [6-13, 8-9, 10-12, 9-6] & 375.04 \\
    49 & [6-13, 11-12, 8-9, 9-6] & 378.54 \\
    80 & [6-13, 6-10, 11-12, 8-9, 10-12] & 420.63 \\
    189 & [6-13, 6-10, 8-9, 10-12, 9-6] & 420.63 \\
    45 & [6-13, 6-10, 8-9, 10-12, 8-12] & 423.96 \\
    70 & [6-13, 8-9, 10-12, 9-6] & 424.12 \\
    157 & [6-13, 6-10, 11-12, 8-9, 8-12] & 427.46 \\
    250 & [6-13, 11-12, 8-9, 10-12, 9-6] & 436.17 \\
    \hline
  \end{tabular}
  \caption{Best configurations with the additional lines}
  \label{tab:top10_1}
\end{table}
The results indicate that the differences in the infraestructure costs are rather minimal. However, installing only four additional lines tends to be the best option. Line 6-13 has been found necessary to ensure a proper operating state of the system under all near-optimal configurations. This makes sense considering that the interconnection usually provides most of the power. Hence, a strong connection to the network is convenient. In fact, the best topology includes two lines connecting the slack bus to the rest of the system are present. 

By ensuring that the $N-1$ criteria is met, we guarantee that all power will be provided independently of which element fails. In reality, this matter may be a bit more complex as two lines could fail simultaneously. Nevertheless, the associated cross-probability is extremely low, and hence, neglected. This implies that no operating costs have to be calculated; it is known beforehand that they will be null as all power is provided for the optimal configuration.

\section{Rising the voltage level}
\subsection{Description}
While installing more lines is a technically feasible strategy, it may not be the most optimal in terms of costs since the voltage level of the grid could be increased. The price to pay for such a change is the replacement of the initial transformers of 25/220~kV and 36/220~kV, for transformers that raise the voltage up to 400~kV (thus, 25/380~kV and 36/380~kV).

In practical terms, raising the voltage may not be as simple as replacing four transformers. For instance, the insulators and the switchgear would have to be changed as well. In the worst scenario, the lines in the towers would have to be more separated, which could cause a replacement of the whole set of supports. To keep the problem arguably simple, it is taken into account that the cost of the transformer station is proportional to the voltage --- as can be deduced in \cite{acer}.

The benefits of increasing the votlage become obvious when observing that the power in a three-phase system such as this one is given by:
\begin{equation}
  S = \sqrt{3}V_{ll}I,
\end{equation}
where $V_{ll}$ identifies the line voltage. With this simple relationship, if it is assumed that $S$ remains constant, and $V_{ll}$ increases by a factor of $380/220\approx \sqrt{3}$, the current would decrease by approximately a factor of $\sqrt{3}$. This means that the active power losses, which are proportional to the square of the current, are roughly reduced by a factor of 3. 

% estimate what substations we could have (or use all substations), and then multiply more or less 40000 * (380 - 220) = 6.4 M euros for each substation changed. Then also evaluate the extra lines needed in the contingency analysis, and see if the total cost is lower than the cost in table tab:top10_1


\subsection{Results}
The same amount of contingencies as before are computed. Out of the 1536, this time more permutations have become feasible. Of course, raising the voltage has a positive effect in this regard, as previously hypothesized. 

% but also consider the added lines here!?

